System.register("doofinder",[],(function(e){"use strict";return{execute:function(){
/*! *****************************************************************************
            Copyright (c) Microsoft Corporation. All rights reserved.
            Licensed under the Apache License, Version 2.0 (the "License"); you may not use
            this file except in compliance with the License. You may obtain a copy of the
            License at http://www.apache.org/licenses/LICENSE-2.0

            THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
            KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
            WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
            MERCHANTABLITY OR NON-INFRINGEMENT.

            See the Apache Version 2.0 License for specific language governing permissions
            and limitations under the License.
            ***************************************************************************** */
function t(e,t,r,s){return new(r||(r=Promise))((function(i,n){function o(e){try{l(s.next(e))}catch(e){n(e)}}function a(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(o,a)}l((s=s.apply(e,t||[])).next())}))}e({DoofinderSorting:void 0,QueryTypes:void 0,TransformerOptions:void 0,Zone:void 0});var r,s,i,n,o,a=Object.prototype.hasOwnProperty,l=Array.isArray,u=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),c=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},s=0;s<e.length;++s)void 0!==e[s]&&(r[s]=e[s]);return r},h={arrayToObject:c,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],s=0;s<t.length;++s)for(var i=t[s],n=i.obj[i.prop],o=Object.keys(n),a=0;a<o.length;++a){var u=o[a],c=n[u];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(t.push({obj:n,prop:u}),r.push(c))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(l(r)){for(var s=[],i=0;i<r.length;++i)void 0!==r[i]&&s.push(r[i]);t.obj[t.prop]=s}}}(t),e},decode:function(e,t,r){var s=e.replace(/\+/g," ");if("iso-8859-1"===r)return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch(e){return s}},encode:function(e,t,r){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var i="",n=0;n<s.length;++n){var o=s.charCodeAt(n);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?i+=s.charAt(n):o<128?i+=u[o]:o<2048?i+=u[192|o>>6]+u[128|63&o]:o<55296||o>=57344?i+=u[224|o>>12]+u[128|o>>6&63]+u[128|63&o]:(n+=1,o=65536+((1023&o)<<10|1023&s.charCodeAt(n)),i+=u[240|o>>18]+u[128|o>>12&63]+u[128|o>>6&63]+u[128|63&o])}return i},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,s){if(!r)return t;if("object"!=typeof r){if(l(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(s&&(s.plainObjects||s.allowPrototypes)||!a.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var i=t;return l(t)&&!l(r)&&(i=c(t,s)),l(t)&&l(r)?(r.forEach((function(r,i){if(a.call(t,i)){var n=t[i];n&&"object"==typeof n&&r&&"object"==typeof r?t[i]=e(n,r,s):t.push(r)}else t[i]=r})),t):Object.keys(r).reduce((function(t,i){var n=r[i];return a.call(t,i)?t[i]=e(t[i],n,s):t[i]=n,t}),i)}},p=String.prototype.replace,f=/%20/g,d={RFC1738:"RFC1738",RFC3986:"RFC3986"},y=h.assign({default:d.RFC3986,formatters:{RFC1738:function(e){return p.call(e,f,"+")},RFC3986:function(e){return String(e)}}},d),m=Object.prototype.hasOwnProperty,g={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},_=Array.isArray,v=Array.prototype.push,b=function(e,t){v.apply(e,_(t)?t:[t])},O=Date.prototype.toISOString,j=y.default,w={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:h.encode,encodeValuesOnly:!1,format:j,formatter:y.formatters[j],indices:!1,serializeDate:function(e){return O.call(e)},skipNulls:!1,strictNullHandling:!1},q=function e(t,r,s,i,n,o,a,l,u,c,p,f,d){var y,m=t;if("function"==typeof a?m=a(r,m):m instanceof Date?m=c(m):"comma"===s&&_(m)&&(m=m.join(",")),null===m){if(i)return o&&!f?o(r,w.encoder,d,"key"):r;m=""}if("string"==typeof(y=m)||"number"==typeof y||"boolean"==typeof y||"symbol"==typeof y||"bigint"==typeof y||h.isBuffer(m))return o?[p(f?r:o(r,w.encoder,d,"key"))+"="+p(o(m,w.encoder,d,"value"))]:[p(r)+"="+p(String(m))];var g,v=[];if(void 0===m)return v;if(_(a))g=a;else{var O=Object.keys(m);g=l?O.sort(l):O}for(var j=0;j<g.length;++j){var q=g[j];n&&null===m[q]||(_(m)?b(v,e(m[q],"function"==typeof s?s(r,q):r,s,i,n,o,a,l,u,c,p,f,d)):b(v,e(m[q],r+(u?"."+q:"["+q+"]"),s,i,n,o,a,l,u,c,p,f,d)))}return v},P=(Object.prototype.hasOwnProperty,function(e,t){var r,s=e,i=function(e){if(!e)return w;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||w.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=y.default;if(void 0!==e.format){if(!m.call(y.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var s=y.formatters[r],i=w.filter;return("function"==typeof e.filter||_(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:w.addQueryPrefix,allowDots:void 0===e.allowDots?w.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:w.charsetSentinel,delimiter:void 0===e.delimiter?w.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:w.encode,encoder:"function"==typeof e.encoder?e.encoder:w.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:w.encodeValuesOnly,filter:i,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:w.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:w.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:w.strictNullHandling}}(t);"function"==typeof i.filter?s=(0,i.filter)("",s):_(i.filter)&&(r=i.filter);var n,o=[];if("object"!=typeof s||null===s)return"";n=t&&t.arrayFormat in g?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var a=g[n];r||(r=Object.keys(s)),i.sort&&r.sort(i.sort);for(var l=0;l<r.length;++l){var u=r[l];i.skipNulls&&null===s[u]||b(o,q(s[u],u,a,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.formatter,i.encodeValuesOnly,i.charset))}var c=o.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""});!function(e){e.EU="eu1",e.US="us1"}(r||(r=e("Zone",{}))),function(e){e.ASC="asc",e.DESC="desc"}(s||(s=e("DoofinderSorting",{}))),function(e){e.Basic="basic",e.OnlyID="onlyid"}(i||(i=e("TransformerOptions",{}))),function(e){e.MatchAnd="match_and",e.MatchOr="match_or",e.Fuzzy="fuzzy",e.PhoneticText="phonetic_text"}(n||(n=e("QueryTypes",{}))),function(e){e.Terms="terms",e.Range="range"}(o||(o={}));class x{constructor(e){this._results=[],this._page=1,this._total=null,this._total_found=null,this._max_score=null,this._query=null,this._query_counter=null,this._query_name=null,this._results_per_page=null,this._facets=null,this._filters=null,this._raw=null,e&&this.loadResults(e)}loadFacets(e){this._facets=Object.keys(e).map(t=>{if(console.log("Loading key",t),"terms"in e[t]){let r=[];e[t].terms.buckets.forEach(e=>{r.push(e)});let s={};return s[t]=r,s}if("range"in e[t]){let r={};return r[t]=e[t].range.buckets[0].stats,r}})}get results(){return this._results}get page(){return this._page}get total(){return this._total}get total_found(){return this._total_found}get max_score(){return this._max_score}get query(){return this._query}get query_counter(){return this._query_counter}get query_name(){return this._query_name}get results_per_page(){return this._results_per_page}get facets(){return this._facets}get filters(){return this._filters}get raw(){return this._raw}loadResults(e){this._raw=e,e.total_found>0?this._results=e.results:this._results=[],this._page=e.page,this._total=e.total,this._total_found=e.total_found,this._max_score=e.max_score,this._query=e.query,this._query_name=e.query_name,this._query_counter=e.query_counter,this._results_per_page=e.results_per_page,e.facets&&this.loadFacets(e.facets),e.filters&&(this._filters=e.filters)}copy(){return new x(this._raw)}}e("DoofinderResult",x);const S=e=>Array.isArray(e),z=e=>(e=>"[object Object]"===Object.prototype.toString.call(e))(e)&&e.constructor===Object&&!e.nodeType&&!e.setInterval,C=e=>null!=e;class k{constructor(e){if(this.params={},this.hashid=null,"string"==typeof e)this.hashid=e,this.params.hashid=this.hashid;else if(e instanceof k){const t=e.getParams();t.query=e.getQuery(),this.params=t}else"object"==typeof e&&(this.params="params"in e?e.params:e)}search(e){this.params.query=e}clear(){this.params={}}setParameter(e,t){if("params"===e)throw new Error("Wrong parameter name!");this.params[e]=t}setParameters(e){this.params=Object.assign({},this.params,e)}addFilter(e,t,r="filter"){let s={};r in this.params&&(s=this.params[r]),s[e]||(s[e]=[]),z(t)?s[e]=t:s[e].push(t),this.params[r]=s}removeFilter(e,t,r="filter"){const s=this.params[r];if(s[e]){const i=s[e].indexOf(t);-1!==i&&(s[e].splice(i,1),this.params[r]=s,this.params.page=1)}}hasFilter(e,t,r="filter"){const s=this.params[r]||{};return e in s&&(!t||-1!==s[e].indexOf(t))}toggleFilter(e,t,r="filter"){this.hasFilter(e,t,r)?this.removeFilter(e,t,r):this.addFilter(e,t,r)}setFilters(e,t="filter"){this.params[t]=e,this.params.page=1}addExclusion(e,t){this.addFilter(e,t,"exclude")}removeExclusion(e,t){this.removeFilter(e,t,"exclude")}setExclusions(e){this.setFilters(e,"exclude")}page(e){e?this.setParameter("page",e):delete this.params.page}nextPage(){this.setParameter("page",(this.params.page||1)+1)}resultsPerPage(e){e?this.setParameter("rpp",e):delete this.params.rpp}setTypes(e){e?this.setParameter("type",e):delete this.params.type}addType(e){const t=[];"string"==typeof this.params.type&&t.push(this.params.type),t.push(e),this.setParameter("type",t)}removeType(e){if(this.params.type)if(S(this.params.type)){const t=this.params.type.indexOf(e);-1!==t&&this.params.type.splice(1,t)}else this.params.type===e&&delete this.params.type}transformer(e){e?this.setParameter("transformer",e):delete this.params.transformer}timeout(e){e?this.setParameter("timeout",e):delete this.params.timeout}jsonp(e){e?this.setParameter("jsonp",e):delete this.params.jsonp}queryName(e){e?this.setParameter("query_name",e):delete this.params.query_name}noStats(e){e&&e?this.setParameter("nostats",1):delete this.params.nostats}hasParameter(e){return e in this.params}getParams(){const e=JSON.parse(JSON.stringify(this.params));return delete e.query,e}getQuery(){return this.params.query}}e("Query",k);class F{constructor(){this.pool={},this._zone=r.EU}static getInstance(){return this.instance||(this.instance=new F),this.instance}getClient(){return this.zone in this.pool||(this.pool[this.zone]=new E(null,{zone:this.zone})),this.pool[this.zone]}set zone(e){this._zone=e}get zone(){return this._zone}}e("ClientRepo",F);class D{request(e,r){return t(this,void 0,void 0,(function*(){if(-1===e.indexOf("http")&&r&&r.host){const t=r.protocol||"http:",s=r.port||"";e=`${t}//${r.host}${s}${e}`}const t=yield fetch(e,r);if(t.ok){return{statusCode:200,data:yield t.json()}}try{const e=yield t.json();return{statusCode:t.status,data:e}}catch(e){return{statusCode:t.status,error:e}}}))}}class E{constructor(e,t={}){this.apiVersion="5",this.hashid=null,this.httpClient=null,this.version=null,e&&(this.hashid=e);let r,s=null;if("apiKey"in t){if([r,s]=t.apiKey.split("-"),r&&!s)throw new Error("invalid `apiKey`")}else"zone"in t&&(r=t.zone);if(!t.zone&&!t.apiKey)throw new Error("`apiKey` or `zone` must be defined");let[i,n]=(t.address||`${r}-search.doofinder.com`).split("://");C(n)||(n=i,i=null);const[o,a]=n.split(":");this.requestOptions={host:o,port:a,headers:t.headers||{}},C(i)&&(this.requestOptions.protocol=`${i}:`),C(s)&&(this.requestOptions.headers.Authorization=s),"Authorization"in this.requestOptions.headers&&(this.requestOptions.protocol="https:"),this.httpClient=new D,this.version=`${t.version||this.apiVersion}`}request(e){return t(this,void 0,void 0,(function*(){return yield this.httpClient.request(e,this.requestOptions)}))}search(e,r,s=!0){return t(this,void 0,void 0,(function*(){const t=this._buildSearchQueryString(e,r),i=yield this.request(`/${this.version}/search?${t}`);return s&&i.statusCode>=200&&i.statusCode<=299?new x(i.data):i}))}options(e){return t(this,void 0,void 0,(function*(){return e=e?`?${e}`:"",yield this.request(`/${this.version}/options/${this.hashid}${e}`)}))}stats(e="",r){return t(this,void 0,void 0,(function*(){const t={hashid:this.hashid,random:(new Date).getTime()};let s=P(Object.assign(t,r||{}));return null!=s&&(s=`?${s}`),yield this.request(`/${this.version}/stats/${e}${s}`)}))}_buildSearchQueryString(e,t){let r=new k;null==e?(r.search(""),r.setParameters(t||{})):"string"==typeof e?(e=" "===(e=e.replace(/\s+/g," "))?e:e.trim(),r.search(e),r.setParameters(t||{})):r=e,this.hashid&&!r.hasParameter("hashid")&&r.setParameter("hashid",this.hashid);const s=r.getParams();if(s.query=r.getQuery(),S(s.type)&&1===s.type.length&&(s.type=s.type[0]),z(s.sort)&&Object.keys(s.sort).length>1)throw new Error("To sort by multiple fields use an Array of Objects");return P(s,{skipNulls:!1})}}e("Client",E)}}}));
