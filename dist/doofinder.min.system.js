System.register("doofinder",[],(function(t){"use strict";return{execute:function(){
/*! *****************************************************************************
            Copyright (c) Microsoft Corporation. All rights reserved.
            Licensed under the Apache License, Version 2.0 (the "License"); you may not use
            this file except in compliance with the License. You may obtain a copy of the
            License at http://www.apache.org/licenses/LICENSE-2.0

            THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
            KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
            WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
            MERCHANTABLITY OR NON-INFRINGEMENT.

            See the Apache Version 2.0 License for specific language governing permissions
            and limitations under the License.
            ***************************************************************************** */
function e(t,e,r,s){return new(r||(r=Promise))((function(i,n){function o(t){try{l(s.next(t))}catch(t){n(t)}}function a(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){t.done?i(t.value):new r((function(e){e(t.value)})).then(o,a)}l((s=s.apply(t,e||[])).next())}))}t({DoofinderSorting:void 0,QueryTypes:void 0,TransformerOptions:void 0,Zone:void 0});var r,s,i,n,o,a=Object.prototype.hasOwnProperty,l=Array.isArray,u=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),c=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},s=0;s<t.length;++s)void 0!==t[s]&&(r[s]=t[s]);return r},h={arrayToObject:c,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],s=0;s<e.length;++s)for(var i=e[s],n=i.obj[i.prop],o=Object.keys(n),a=0;a<o.length;++a){var u=o[a],c=n[u];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(e.push({obj:n,prop:u}),r.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(l(r)){for(var s=[],i=0;i<r.length;++i)void 0!==r[i]&&s.push(r[i]);e.obj[e.prop]=s}}}(e),t},decode:function(t,e,r){var s=t.replace(/\+/g," ");if("iso-8859-1"===r)return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch(t){return s}},encode:function(t,e,r){if(0===t.length)return t;var s=t;if("symbol"==typeof t?s=Symbol.prototype.toString.call(t):"string"!=typeof t&&(s=String(t)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var i="",n=0;n<s.length;++n){var o=s.charCodeAt(n);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?i+=s.charAt(n):o<128?i+=u[o]:o<2048?i+=u[192|o>>6]+u[128|63&o]:o<55296||o>=57344?i+=u[224|o>>12]+u[128|o>>6&63]+u[128|63&o]:(n+=1,o=65536+((1023&o)<<10|1023&s.charCodeAt(n)),i+=u[240|o>>18]+u[128|o>>12&63]+u[128|o>>6&63]+u[128|63&o])}return i},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,r,s){if(!r)return e;if("object"!=typeof r){if(l(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(s&&(s.plainObjects||s.allowPrototypes)||!a.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var i=e;return l(e)&&!l(r)&&(i=c(e,s)),l(e)&&l(r)?(r.forEach((function(r,i){if(a.call(e,i)){var n=e[i];n&&"object"==typeof n&&r&&"object"==typeof r?e[i]=t(n,r,s):e.push(r)}else e[i]=r})),e):Object.keys(r).reduce((function(e,i){var n=r[i];return a.call(e,i)?e[i]=t(e[i],n,s):e[i]=n,e}),i)}},p=String.prototype.replace,f=/%20/g,d={RFC1738:"RFC1738",RFC3986:"RFC3986"},y=h.assign({default:d.RFC3986,formatters:{RFC1738:function(t){return p.call(t,f,"+")},RFC3986:function(t){return String(t)}}},d),m=Object.prototype.hasOwnProperty,g={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},_=Array.isArray,v=Array.prototype.push,b=function(t,e){v.apply(t,_(e)?e:[e])},O=Date.prototype.toISOString,j=y.default,w={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:h.encode,encodeValuesOnly:!1,format:j,formatter:y.formatters[j],indices:!1,serializeDate:function(t){return O.call(t)},skipNulls:!1,strictNullHandling:!1},q=function t(e,r,s,i,n,o,a,l,u,c,p,f,d){var y,m=e;if("function"==typeof a?m=a(r,m):m instanceof Date?m=c(m):"comma"===s&&_(m)&&(m=m.join(",")),null===m){if(i)return o&&!f?o(r,w.encoder,d,"key"):r;m=""}if("string"==typeof(y=m)||"number"==typeof y||"boolean"==typeof y||"symbol"==typeof y||"bigint"==typeof y||h.isBuffer(m))return o?[p(f?r:o(r,w.encoder,d,"key"))+"="+p(o(m,w.encoder,d,"value"))]:[p(r)+"="+p(String(m))];var g,v=[];if(void 0===m)return v;if(_(a))g=a;else{var O=Object.keys(m);g=l?O.sort(l):O}for(var j=0;j<g.length;++j){var q=g[j];n&&null===m[q]||(_(m)?b(v,t(m[q],"function"==typeof s?s(r,q):r,s,i,n,o,a,l,u,c,p,f,d)):b(v,t(m[q],r+(u?"."+q:"["+q+"]"),s,i,n,o,a,l,u,c,p,f,d)))}return v},P=(Object.prototype.hasOwnProperty,function(t,e){var r,s=t,i=function(t){if(!t)return w;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||w.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=y.default;if(void 0!==t.format){if(!m.call(y.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var s=y.formatters[r],i=w.filter;return("function"==typeof t.filter||_(t.filter))&&(i=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:w.addQueryPrefix,allowDots:void 0===t.allowDots?w.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:w.charsetSentinel,delimiter:void 0===t.delimiter?w.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:w.encode,encoder:"function"==typeof t.encoder?t.encoder:w.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:w.encodeValuesOnly,filter:i,formatter:s,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:w.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:w.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:w.strictNullHandling}}(e);"function"==typeof i.filter?s=(0,i.filter)("",s):_(i.filter)&&(r=i.filter);var n,o=[];if("object"!=typeof s||null===s)return"";n=e&&e.arrayFormat in g?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var a=g[n];r||(r=Object.keys(s)),i.sort&&r.sort(i.sort);for(var l=0;l<r.length;++l){var u=r[l];i.skipNulls&&null===s[u]||b(o,q(s[u],u,a,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.formatter,i.encodeValuesOnly,i.charset))}var c=o.join(i.delimiter),h=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""});!function(t){t.EU="eu1",t.US="us1"}(r||(r=t("Zone",{}))),function(t){t.ASC="asc",t.DESC="desc"}(s||(s=t("DoofinderSorting",{}))),function(t){t.Basic="basic",t.OnlyID="onlyid"}(i||(i=t("TransformerOptions",{}))),function(t){t.MatchAnd="match_and",t.MatchOr="match_or",t.Fuzzy="fuzzy",t.PhoneticText="phonetic_text"}(n||(n=t("QueryTypes",{}))),function(t){t.Terms="terms",t.Range="range"}(o||(o={}));class x{constructor(t){this._results=[],this._page=1,this._total=null,this._total_found=null,this._max_score=null,this._query=null,this._query_counter=null,this._query_name=null,this._results_per_page=null,this._facets=null,this._filters=null,this._raw=null,t&&this.loadResults(t)}loadFacets(t){this._facets=Object.keys(t).map(e=>{if(console.log("Loading key",e),"terms"in t[e]){const r=[];t[e].terms.buckets.forEach(t=>{r.push(t)});const s={};return s[e]=r,s}if("range"in t[e]){const r={};return r[e]=t[e].range.buckets[0].stats,r}})}get results(){return this._results}get page(){return this._page}get total(){return this._total}get total_found(){return this._total_found}get max_score(){return this._max_score}get query(){return this._query}get query_counter(){return this._query_counter}get query_name(){return this._query_name}get results_per_page(){return this._results_per_page}get facets(){return this._facets}get filters(){return this._filters}get raw(){return this._raw}loadResults(t){this._raw=t,t.total_found>0?this._results=t.results:this._results=[],this._page=t.page,this._total=t.total,this._total_found=t.total_found,this._max_score=t.max_score,this._query=t.query,this._query_name=t.query_name,this._query_counter=t.query_counter,this._results_per_page=t.results_per_page,t.facets&&this.loadFacets(t.facets),t.filters&&(this._filters=t.filters)}copy(){return new x(this._raw)}}t("DoofinderResult",x);const S=t=>Array.isArray(t),z=t=>(t=>"[object Object]"===Object.prototype.toString.call(t))(t)&&t.constructor===Object&&!t.nodeType&&!t.setInterval,C=t=>null!=t;class k{constructor(t){if(this.params={},this.hashid=null,"string"==typeof t)this.hashid=t,this.params.hashid=this.hashid;else if(t instanceof k){const e=t.getParams();e.query=t.getQuery(),this.params=e}else"object"==typeof t&&(this.params="params"in t?t.params:t)}search(t){this.params.query=t}clear(){this.params={}}setParameter(t,e){if("params"===t)throw new Error("Wrong parameter name!");this.params[t]=e}setParameters(t){this.params=Object.assign({},this.params,t)}addFilter(t,e,r="filter"){let s={};r in this.params&&(s=this.params[r]),s[t]||(s[t]=[]),z(e)?s[t]=e:s[t].push(e),this.params[r]=s,this.params.page=1}removeFilter(t,e,r="filter"){const s=this.params[r];if(s[t]){const i=s[t].indexOf(e);-1!==i&&(s[t].splice(i,1),this.params[r]=s,this.params.page=1)}}hasFilter(t,e,r="filter"){const s=this.params[r]||{};return t in s&&(!e||-1!==s[t].indexOf(e))}toggleFilter(t,e,r="filter"){this.hasFilter(t,e,r)?this.removeFilter(t,e,r):this.addFilter(t,e,r)}setFilters(t,e="filter"){this.params[e]=t,this.params.page=1}addExclusion(t,e){this.addFilter(t,e,"exclude")}removeExclusion(t,e){this.removeFilter(t,e,"exclude")}setExclusions(t){this.setFilters(t,"exclude")}page(t){t?this.setParameter("page",t):delete this.params.page}nextPage(){this.setParameter("page",(this.params.page||1)+1)}resultsPerPage(t){t?this.setParameter("rpp",t):delete this.params.rpp}setTypes(t){t?this.setParameter("type",t):delete this.params.type}addType(t){const e=[];"string"==typeof this.params.type&&e.push(this.params.type),e.push(t),this.setParameter("type",e)}removeType(t){if(this.params.type)if(S(this.params.type)){const e=this.params.type.indexOf(t);-1!==e&&this.params.type.splice(1,e)}else this.params.type===t&&delete this.params.type}transformer(t){t?this.setParameter("transformer",t):delete this.params.transformer}timeout(t){t?this.setParameter("timeout",t):delete this.params.timeout}jsonp(t){t?this.setParameter("jsonp",t):delete this.params.jsonp}queryName(t){t?this.setParameter("query_name",t):delete this.params.query_name}noStats(t){t&&t?this.setParameter("nostats",1):delete this.params.nostats}hasParameter(t){return t in this.params}getParams(){const t=JSON.parse(JSON.stringify(this.params));return delete t.query,t}getQuery(){return this.params.query}}t("Query",k);class F{constructor(){this.pool={},this._zone=r.EU}static getInstance(){return this.instance||(this.instance=new F),this.instance}getClient(){return this.zone in this.pool||(this.pool[this.zone]=new E(null,{zone:this.zone})),this.pool[this.zone]}set zone(t){this._zone=t}get zone(){return this._zone}}t("ClientRepo",F);class D{request(t,r){return e(this,void 0,void 0,(function*(){if(-1===t.indexOf("http")&&r&&r.host){const e=r.protocol||"http:",s=r.port||"";t=`${e}//${r.host}${s}${t}`}const e=yield fetch(t,r);if(e.ok){return{statusCode:200,data:yield e.json()}}try{const t=yield e.json();return{statusCode:e.status,data:t}}catch(t){return{statusCode:e.status,error:t}}}))}}class E{constructor(t,e={}){this.apiVersion="5",this.hashid=null,this.httpClient=null,this.version=null,t&&(this.hashid=t);let r,s=null;if("apiKey"in e){if([r,s]=e.apiKey.split("-"),r&&!s)throw new Error("invalid `apiKey`")}else"zone"in e&&(r=e.zone);if(!e.zone&&!e.apiKey)throw new Error("`apiKey` or `zone` must be defined");let[i,n]=(e.address||`${r}-search.doofinder.com`).split("://");C(n)||(n=i,i=null);const[o,a]=n.split(":");this.requestOptions={host:o,port:a,headers:e.headers||{}},C(i)&&(this.requestOptions.protocol=`${i}:`),C(s)&&(this.requestOptions.headers.Authorization=s),"Authorization"in this.requestOptions.headers&&(this.requestOptions.protocol="https:"),this.httpClient=new D,this.version=`${e.version||this.apiVersion}`}request(t){return e(this,void 0,void 0,(function*(){return yield this.httpClient.request(t,this.requestOptions)}))}search(t,r,s=!0){return e(this,void 0,void 0,(function*(){const e=this._buildSearchQueryString(t,r),i=yield this.request(`/${this.version}/search?${e}`);return s&&i.statusCode>=200&&i.statusCode<=299?new x(i.data):i}))}options(t){return e(this,void 0,void 0,(function*(){return t=t?`?${t}`:"",yield this.request(`/${this.version}/options/${this.hashid}${t}`)}))}stats(t="",r){return e(this,void 0,void 0,(function*(){const e={hashid:this.hashid,random:(new Date).getTime()};let s=P(Object.assign(e,r||{}));return null!=s&&(s=`?${s}`),yield this.request(`/${this.version}/stats/${t}${s}`)}))}_buildSearchQueryString(t,e){let r=new k;null==t?(r.search(""),r.setParameters(e||{})):"string"==typeof t?(t=" "===(t=t.replace(/\s+/g," "))?t:t.trim(),r.search(t),r.setParameters(e||{})):r=t,this.hashid&&!r.hasParameter("hashid")&&r.setParameter("hashid",this.hashid);const s=r.getParams();if(s.query=r.getQuery(),S(s.type)&&1===s.type.length&&(s.type=s.type[0]),z(s.sort)&&Object.keys(s.sort).length>1)throw new Error("To sort by multiple fields use an Array of Objects");return P(s,{skipNulls:!1})}}t("Client",E)}}}));
