"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var has=Object.prototype.hasOwnProperty,isArray=Array.isArray,hexTable=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),compactQueue=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(isArray(r)){for(var i=[],o=0;o<r.length;++o)void 0!==r[o]&&i.push(r[o]);t.obj[t.prop]=i}}},arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(r[i]=e[i]);return r},merge=function e(t,r,i){if(!r)return t;if("object"!=typeof r){if(isArray(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(i&&(i.plainObjects||i.allowPrototypes)||!has.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return isArray(t)&&!isArray(r)&&(o=arrayToObject(t,i)),isArray(t)&&isArray(r)?(r.forEach((function(r,o){if(has.call(t,o)){var n=t[o];n&&"object"==typeof n&&r&&"object"==typeof r?t[o]=e(n,r,i):t.push(r)}else t[o]=r})),t):Object.keys(r).reduce((function(t,o){var n=r[o];return has.call(t,o)?t[o]=e(t[o],n,i):t[o]=n,t}),o)},assign=function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},decode=function(e,t,r){var i=e.replace(/\+/g," ");if("iso-8859-1"===r)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(e){return i}},encode=function(e,t,r){if(0===e.length)return e;var i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===r)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",n=0;n<i.length;++n){var s=i.charCodeAt(n);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?o+=i.charAt(n):s<128?o+=hexTable[s]:s<2048?o+=hexTable[192|s>>6]+hexTable[128|63&s]:s<55296||s>=57344?o+=hexTable[224|s>>12]+hexTable[128|s>>6&63]+hexTable[128|63&s]:(n+=1,s=65536+((1023&s)<<10|1023&i.charCodeAt(n)),o+=hexTable[240|s>>18]+hexTable[128|s>>12&63]+hexTable[128|s>>6&63]+hexTable[128|63&s])}return o},compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var o=t[i],n=o.obj[o.prop],s=Object.keys(n),a=0;a<s.length;++a){var l=s[a],c=n[l];"object"==typeof c&&null!==c&&-1===r.indexOf(c)&&(t.push({obj:n,prop:l}),r.push(c))}return compactQueue(t),e},isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},isBuffer=function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},combine=function(e,t){return[].concat(e,t)},utils={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,merge:merge},replace=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},formats=utils.assign({default:Format.RFC3986,formatters:{RFC1738:function(e){return replace.call(e,percentTwenties,"+")},RFC3986:function(e){return String(e)}}},Format),has$1=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},isArray$1=Array.isArray,push=Array.prototype.push,pushToArray=function(e,t){push.apply(e,isArray$1(t)?t:[t])},toISO=Date.prototype.toISOString,defaultFormat=formats.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:utils.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:formats.formatters[defaultFormat],indices:!1,serializeDate:function(e){return toISO.call(e)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e},stringify=function e(t,r,i,o,n,s,a,l,c,u,f,p,d){var h=t;if("function"==typeof a?h=a(r,h):h instanceof Date?h=u(h):"comma"===i&&isArray$1(h)&&(h=h.join(",")),null===h){if(o)return s&&!p?s(r,defaults.encoder,d,"key"):r;h=""}if(isNonNullishPrimitive(h)||utils.isBuffer(h))return s?[f(p?r:s(r,defaults.encoder,d,"key"))+"="+f(s(h,defaults.encoder,d,"value"))]:[f(r)+"="+f(String(h))];var y,m=[];if(void 0===h)return m;if(isArray$1(a))y=a;else{var b=Object.keys(h);y=l?b.sort(l):b}for(var g=0;g<y.length;++g){var O=y[g];n&&null===h[O]||(isArray$1(h)?pushToArray(m,e(h[O],"function"==typeof i?i(r,O):r,i,o,n,s,a,l,c,u,f,p,d)):pushToArray(m,e(h[O],r+(c?"."+O:"["+O+"]"),i,o,n,s,a,l,c,u,f,p,d)))}return m},normalizeStringifyOptions=function(e){if(!e)return defaults;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||defaults.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=formats.default;if(void 0!==e.format){if(!has$1.call(formats.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=formats.formatters[r],o=defaults.filter;return("function"==typeof e.filter||isArray$1(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===e.allowDots?defaults.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===e.delimiter?defaults.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:defaults.encode,encoder:"function"==typeof e.encoder?e.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:defaults.encodeValuesOnly,filter:o,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:defaults.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:defaults.strictNullHandling}},stringify_1=function(e,t){var r,i=e,o=normalizeStringifyOptions(t);"function"==typeof o.filter?i=(0,o.filter)("",i):isArray$1(o.filter)&&(r=o.filter);var n,s=[];if("object"!=typeof i||null===i)return"";n=t&&t.arrayFormat in arrayPrefixGenerators?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var a=arrayPrefixGenerators[n];r||(r=Object.keys(i)),o.sort&&r.sort(o.sort);for(var l=0;l<r.length;++l){var c=r[l];o.skipNulls&&null===i[c]||pushToArray(s,stringify(i[c],c,a,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var u=s.join(o.delimiter),f=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),u.length>0?f+u:""},has$2=Object.prototype.hasOwnProperty,defaults$1={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:utils.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(e,t){var r,i={},o=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,n=t.parameterLimit===1/0?void 0:t.parameterLimit,s=o.split(t.delimiter,n),a=-1,l=t.charset;if(t.charsetSentinel)for(r=0;r<s.length;++r)0===s[r].indexOf("utf8=")&&(s[r]===charsetSentinel?l="utf-8":s[r]===isoSentinel&&(l="iso-8859-1"),a=r,r=s.length);for(r=0;r<s.length;++r)if(r!==a){var c,u,f=s[r],p=f.indexOf("]="),d=-1===p?f.indexOf("="):p+1;-1===d?(c=t.decoder(f,defaults$1.decoder,l,"key"),u=t.strictNullHandling?null:""):(c=t.decoder(f.slice(0,d),defaults$1.decoder,l,"key"),u=t.decoder(f.slice(d+1),defaults$1.decoder,l,"value")),u&&t.interpretNumericEntities&&"iso-8859-1"===l&&(u=interpretNumericEntities(u)),u&&t.comma&&u.indexOf(",")>-1&&(u=u.split(",")),has$2.call(i,c)?i[c]=utils.combine(i[c],u):i[c]=u}return i},parseObject=function(e,t,r){for(var i=t,o=e.length-1;o>=0;--o){var n,s=e[o];if("[]"===s&&r.parseArrays)n=[].concat(i);else{n=r.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,l=parseInt(a,10);r.parseArrays||""!==a?!isNaN(l)&&s!==a&&String(l)===a&&l>=0&&r.parseArrays&&l<=r.arrayLimit?(n=[])[l]=i:n[a]=i:n={0:i}}i=n}return i},parseKeys=function(e,t,r){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,n=r.depth>0&&/(\[[^[\]]*])/.exec(i),s=n?i.slice(0,n.index):i,a=[];if(s){if(!r.plainObjects&&has$2.call(Object.prototype,s)&&!r.allowPrototypes)return;a.push(s)}for(var l=0;r.depth>0&&null!==(n=o.exec(i))&&l<r.depth;){if(l+=1,!r.plainObjects&&has$2.call(Object.prototype,n[1].slice(1,-1))&&!r.allowPrototypes)return;a.push(n[1])}return n&&a.push("["+i.slice(n.index)+"]"),parseObject(a,t,r)}},normalizeParseOptions=function(e){if(!e)return defaults$1;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?defaults$1.charset:e.charset;return{allowDots:void 0===e.allowDots?defaults$1.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:defaults$1.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:defaults$1.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:defaults$1.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:defaults$1.comma,decoder:"function"==typeof e.decoder?e.decoder:defaults$1.decoder,delimiter:"string"==typeof e.delimiter||utils.isRegExp(e.delimiter)?e.delimiter:defaults$1.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:defaults$1.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:defaults$1.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:defaults$1.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:defaults$1.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:defaults$1.strictNullHandling}},parse=function(e,t){var r=normalizeParseOptions(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var i="string"==typeof e?parseValues(e,r):e,o=r.plainObjects?Object.create(null):{},n=Object.keys(i),s=0;s<n.length;++s){var a=n[s],l=parseKeys(a,i[a],r);o=utils.merge(o,l,r)}return utils.compact(o)},lib={formats:formats,parse:parse,stringify:stringify_1},lib_3=lib.stringify;function _msg(e,t){return t?`[doofinder][${t.constructor.name}]: ${e}`:`[doofinder]: ${e}`}function error(e,t){return new Error(_msg(e,t))}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function __awaiter(e,t,r,i){return new(r||(r=Promise))((function(o,n){function s(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(s,a)}l((i=i.apply(e,t||[])).next())}))}class HttpClient{request(e,t,r){return __awaiter(this,void 0,void 0,(function*(){const i=yield fetch(e,r);if(i.ok){const e=yield i.json();t(void 0,e)}else{let e={};try{const e=yield i.json();t({statusCode:i},e)}catch(r){e={error:r},t({statusCode:i.status},e)}}}))}}const isArray$2=e=>Array.isArray(e),isObject=e=>"[object Object]"===Object.prototype.toString.call(e),isPlainObject=e=>isObject(e)&&e.constructor===Object&&!e.nodeType&&!e.setInterval,isNotNull=e=>null!=e;!function(e){e.ASC="asc",e.DESC="desc"}(exports.DoofinderSorting||(exports.DoofinderSorting={}));class Client{constructor(e,t={}){this.apiVersion="5",this.hashid=null,this.httpClient=null,this.version=null;const[r,i]=(t.apiKey||t.zone||"").split("-");if(!r){let e=null;throw error(e=i?"invalid `apiKey`":"`apiKey` or `zone` must be defined",this)}let[o,n]=(t.address||`${r}-search.doofinder.com`).split("://");isNotNull(n)||(n=o,o=null);const[s,a]=n.split(":");this.requestOptions={host:s,port:a,headers:t.headers||{}},isNotNull(o)&&(this.requestOptions.protocol=`${o}:`),isNotNull(i)&&(this.requestOptions.headers.Authorization=i),"Authorization"in this.requestOptions.headers&&(this.requestOptions.protocol="https:"),this.httpClient=new HttpClient,this.version=`${t.version||this.apiVersion}`}request(e,t){this.httpClient.request(e,t,this.requestOptions)}search(e,t,r){let i=null;"function"==typeof t?(i=t,t={}):i=r;const o=this._buildSearchQueryString(e,t);this.request(`/${this.version}/search?${o}`,i)}options(e,t){"function"==typeof e&&(t=e,e=""),e=e?`?${e}`:"",this.request(`/${this.version}/options/${this.hashid}${e}`,t)}stats(e,t,r){e=isNotNull(e)?e:"";let i={hashid:this.hashid,random:(new Date).getTime()},o=lib_3(Object.assign(i,t||{}));null!=o&&(o=`?${o}`),this.request(`/${this.version}/stats/${e}${o}`,r)}_buildSearchQueryString(e,t){null==e&&(e=""),e=" "===(e=e.replace(/\s+/g," "))?e:e.trim();let r={hashid:this.hashid},i=Object.assign(r,t||{},{query:e});if(isArray$2(i.type)&&1===i.type.length&&(i.type=i.type[0]),isPlainObject(i.sort)&&Object.keys(i.sort).length>1)throw error("To sort by multiple fields use an Array of Objects",this);return lib_3(i,{skipNulls:!1})}}exports.Client=Client;
