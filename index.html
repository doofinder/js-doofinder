<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client</title>

  <link rel="stylesheet" type="text/css" href="dist/doofinder.css">
  <style type="text/css">
    * {
      box-sizing: border-box;
      font-size: 1rem;
      font-family: -apple-system, system-ui, sans-serif;
    }

    body {
      margin: 0;
      padding: 1rem;
    }

    textarea {
      height: 150px;
    }

    #search {
      padding: .5rem;
    }

    .widget {
      width: 400px;
      border: 1px solid #ddd;
      margin: 0 0 1rem 0;
    }

    .widget:last-child {
      margin-bottom: 0;
    }

    .df-results {
      height: 150px;
    }

    .df-term {
      display: block;
      color: inherit;
    }

    .df-term[data-selected] {
      font-weight: bold;
    }

    .row {
      display: flex;
      flex-flow: row nowrap;
    }

    .col {
      flex: 0 0 auto;
    }

    .col + .col {
      margin-left: 1rem;
    }
  </style>

  <script type="text/javascript" src="dist/doofinder.js"></script>
</head>
<body>
  <input class="widget" id="search" type="text" placeholder="Search something">
  <!-- <textarea class="widget" id="search" placeholder="Search something"></textarea> -->

  <div class="row" data-hashid="e723b503db15fe242b934df14b141ccc">
    <div class="col">

      <div class="widget df-results">
        <div class="df-results__content"></div>
      </div>

    </div>
    <div class="col" data-role="facetsContainer"></div>
  </div>

  <script type="text/javascript">

    var $ = doofinder.util.dfdom;
    var bean = doofinder.util.bean;
    var input = new doofinder.widgets.QueryInput('#search');
    var search = [];

    $('[data-hashid]').each(function(row){
      row = $(row);
      var facetsContainer = row.find('[data-role="facetsContainer"]');

      var client = new doofinder.Client(row.data('hashid'), 'eu1');
      var controller = new doofinder.Controller(client);

      client.options(function(err, options){
        // input
        controller.registerWidget(input);

        // results
        var results = new doofinder.widgets.ScrollDisplay(row.find('.df-results'));
        results.on("df:widget:render", function(res){
          console.log("[df:widget:render][" + res.hashid + "] query: '" + res.query + "' page: " + res.page);
        });
        controller.registerWidget(results);

        // facets
        options.facets.forEach(function(facet){
          facetsContainer.append(
            '<div class="widget" data-facetName="' + facet.name + '" data-facetType="' + facet.type + '"></div>'
          );
          if (facet.type === 'terms') {
            controller.registerWidget(
              new doofinder.widgets.TermsFacet(
                row.find('[data-facetName="' + facet.name + '"]'),
                facet.name,
                {
                  size: facet.size,
                  label: facet.label
                }
              )
            );
          } else {
            controller.registerWidget(
              new doofinder.widgets.RangeFacet(
                row.find('[data-facetName="' + facet.name + '"]'),
                facet.name
              )
            );
          }
        });
      });

      search.push(controller);
    });

    input.on("df:input:stop", function(query){
      console.log("[df:input:stop] " + query);
    });

  </script>
</body>
</html>
